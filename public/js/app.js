if(!app)var app=angular.module("myApp",["ui.router","ui.mask","LocalStorageModule","ngResource","ngSanitize","nya.bootstrap.select","moment-picker"]);app.config(["$stateProvider","$urlRouterProvider","$sceDelegateProvider",function(e,t,r){e.state("auth",{url:"/auth",controller:"AuthCtrl",controllerAs:"mv",templateUrl:"./views/home/auth.html"}).state("app",{url:"/app",templateUrl:"./views/home/home.html"}).state("app.projects",{url:"/projects",templateUrl:"./views/projects/projectList.html",controller:"ProjectCtrl"}).state("app.releases",{url:"/project/:id/releases",templateUrl:"./views/projects/projectReleases.html",controllerAs:"mv",controller:"ProjectCtrl"}).state("app.reviewer",{params:{projects:{}},url:"/reviewer",templateUrl:"./views/projects/projectsViewer.html",controller:"ProjectViewerCtrl"}),t.otherwise("/")}]);
!function(){app.controllers||(app.controllers={}),app.controllers.admin=function(t,o,n,e,i,r,c){t.init=function(){n(function(){r.isLoggedAlready()?o.transitionTo("app.projects"):o.transitionTo("auth")})},t.logOut=function(){r.deleteCredentials(),n(function(){o.transitionTo("auth")})},t.parseHTML=function(t){t.HTMLDescription=e.trustAsHtml(t.Description)},t.projects=c.get("projects")},app.controller("AdminCtrl",["$scope","$state","$timeout","$sce","dataService","authService","localStorageService",app.controllers.admin])}();
!function(){app.controllers||(app.controllers={}),app.controllers.auth=function(t,e,o,r,n,a,c,s){t.submit=function(){r.authUser(t.username,t.token).then(function(r){o(function(){"200"==r.status&&(a.success(c.APP_AUTH_SUCCESS_TITLE,c.APP_AUTH_SUCCESS_MESSAGE),n.createCredentials(t.username,t.token),s.set("projects",r.data),e.transitionTo("app.projects"))})}).catch(function(t){a.error(c.APP_AUTH_ERROR_TITLE,c.APP_AUTH_ERROR_MESSAGE)})}},app.controller("AuthCtrl",["$scope","$state","$timeout","dataService","authService","toastrService","constantsService","localStorageService",app.controllers.auth])}();
!function(){app.controllers||(app.controllers={}),app.controllers.header=function(e,n,r){e.mv.items=n.APP_NAVIGATION,e.mv.username=r.get("username")}}();


!function(){app.controllers||(app.controllers={}),app.controllers.chartBars=function(o){}}();
!function(){app.controllers||(app.controllers={}),app.controllers.projects=function(e,t,a,r,l,s,i,c){e.selected={},e.selected.projects=[],e.selectAll=!1,e.releases=[],e.users=[],e.project=[],e.incidents=[],e.customProperties=[],e.filteredByRelease=[],e.years=[],e.chart1={},e.chart2={},e.chart3={},e.chart4={},e.chart5={},e.chart6={},a.getProjectById(t.id).then(function(t){e.project=t.data}),a.getProjectUsersById(t.id).then(function(t){e.users=t.data}),a.getProjectIncidentsCountById(t.id).then(function(r){a.getProjectIncidentsById(t.id,r.data).then(function(t){e.incidents=t.data,e.years=i.getLabelsArray(e.incidents,"CreationDate","year");var a=new Date;e.selected.year=moment(a.setFullYear(a.getFullYear()-1)).year(),l(e.build())})}),a.getProjectReleasesById(t.id).then(function(t){e.releases=t.data}),e.build=function(){e.filterReleaseByMonths(),e.filterReleases(),e.selected.release=null,e.filteredByRelease=[]},e.filterReleaseByMonths=function(){var t,a=[e.selected.year,"filterByYear"],l=r("filterFindBy")(e.incidents,a);e.releasesVersionNumber=i.getLabelsArray(l,"DetectedReleaseVersionNumber","default");var c=[e.releasesVersionNumber,"filterReleaseVersionNumber"];e.releasesNames=r("filterFindBy")(e.releases,c),e.chart1.labels=s.APP_PROJECT_MONTHS,e.chart1.data=i.bindArrayWithQuantity(e.chart1.labels,l,"filterByMonth"),e.chart1.display=i.validateDataArray(e.chart1.data),e.chart1.options={defaultFontStyle:"italic",title:{display:!0,text:s.CHART_TITLES[0]},legend:{display:!1}},t=i.setChartObject("chart1","bar",e.chart1.labels,e.chart1.data,e.chart1.options,"Incidents",s.CHART_COLORS[0],s.CHART_COLORS[1],"")},e.filterReleases=function(){var t,a=[e.selected.year,"filterByYear"],l=r("filterFindBy")(e.incidents,a),c=i.getLabelsArray(l,"DetectedReleaseVersionNumber","default");e.chart2.labels=c,e.chart2.data=i.bindArrayWithQuantity(c,e.incidents,"filterByReleaseVersionNumber"),e.chart2.display=i.validateDataArray(e.chart2.data),e.chart2.options={defaultFontSize:4,title:{display:!0,text:s.CHART_TITLES[1]},legend:{display:!1},scales:{xAxes:[{ticks:{fontSize:8}}]}},t=i.setChartObject("chart2","bar",e.chart2.labels,e.chart2.data,e.chart2.options,"",s.CHART_COLORS[0],s.CHART_COLORS[1],"")},e.filterReleaseByReleaseVersion=function(t){var a,l=[t.VersionNumber,"filterByReleaseVersionNumber"];e.filteredByRelease=r("filterFindBy")(e.incidents,l);var c=i.getLabelsArray(e.filteredByRelease,"IncidentTypeName","default");e.chart3.labels=c,e.chart3.data=i.bindArrayWithQuantity(c,e.filteredByRelease,"filterByIncidentTypeName"),e.chart3.display=i.validateDataArray(e.chart3.data),e.chart3.options={title:{display:!0,text:s.CHART_TITLES[2]},legend:{display:!1},scales:{xAxes:[{ticks:{fontSize:8}}]}},a=i.setChartObject("chart3","bar",e.chart3.labels,e.chart3.data,e.chart3.options,"",s.CHART_COLORS[0],s.CHART_COLORS[1],""),e.filterReleaseByStatus(),e.filterReleaseByOpenerName(),e.filterReleaseByPriority()},e.filterReleaseByStatus=function(){var t,a=i.getLabelsArray(e.filteredByRelease,"IncidentStatusName","default");e.chart4.labels=a,e.chart4.data=i.bindArrayWithQuantity(a,e.filteredByRelease,"filterByIncidentStatusName"),e.chart4.display=i.validateDataArray(e.chart4.data),e.chart4.options={title:{display:!0,text:s.CHART_TITLES[3]},legend:{display:!0}},t=i.setChartObject("chart4","pie",e.chart4.labels,e.chart4.data,e.chart4.options,"",s.CHART_COLORS[0],s.CHART_COLORS[1],"")},e.filterReleaseByOpenerName=function(){var t,a=i.getLabelsArray(e.filteredByRelease,"OpenerName","default");e.chart5.labels=a,e.chart5.data=i.bindArrayWithQuantity(a,e.filteredByRelease,"filterByIncidentOpenerName"),e.chart5.display=i.validateDataArray(e.chart5.data),e.chart5.options={title:{display:!0,text:s.CHART_TITLES[4]},legend:{display:!1},scales:{xAxes:[{ticks:{fontSize:8}}]}},t=i.setChartObject("chart5","bar",e.chart5.labels,e.chart5.data,e.chart5.options,"",s.CHART_COLORS[0],s.CHART_COLORS[1],"random")},e.filterReleaseByPriority=function(){var t,a=i.getLabelsArray(e.filteredByRelease,"PriorityName","default");e.chart6.labels=a,e.chart6.data=i.bindArrayWithQuantity(a,e.filteredByRelease,"filterByPriorityName"),e.chart6.display=i.validateDataArray(e.chart6.data),e.chart6.options={title:{display:!0,text:s.CHART_TITLES[5]},legend:{display:!0}},t=i.setChartObject("chart6","pie",e.chart6.labels,e.chart6.data,e.chart6.options,"",s.CHART_COLORS[0],s.CHART_COLORS[1],"random")},e.chooseProject=function(t){if(t.Checked=!t.Checked,!t.Checked)return void e.selected.projects.map(function(a){a.ProjectId==t.ProjectId&&(e.selected.projects.splice(e.selected.projects.indexOf(a),1),c.info("Project Unselected",t.Name+" unselected."))});var a=!1;e.selected.projects.map(function(e){e.ProjectId==t.ProjectId&&(a=!0)}),a||(e.selected.projects.push(t),c.info("Project",t.Name+" selected."))},e.toggleAllSelect=function(){e.selectAll?(e.projects.map(function(e){e.Checked=!1}),e.selected.projects=[],e.selectAll=!1,c.info("None","no projects are selected.")):(e.selected.projects=[],e.projects.map(function(t){t.Checked=!0,e.selected.projects.push(t)}),e.selectAll=!0,c.info("All Selected",e.selected.projects.length+" projects were selected."))}},app.controller("ProjectCtrl",["$scope","$stateParams","dataService","$filter","$timeout","constantsService","helperService","toastrService",app.controllers.projects])}();
!function(){app.controllers||(app.controllers={}),app.controllers.projectsViewer=function(t,e,a,r,c,n,i){t.projects=e.projects,t.incidents=[],t.filterBy,t.selected={},t.startDate,t.endDate,t.loading=!1,t.chart1={},t.chart2={},t.chart3={},t.chart4={},t.chart5={},t.chart6={},t.$watch("selected.date",function(){t.getDates()}),t.$watch("filterBy",function(){t.getDates()}),t.runReviewer=function(){var e=0;t.incidents=[],t.loading=!0,t.chart1.chart&&(alert("here"),t.chart1.chart.update(),t.chart2.chart.update(),t.chart3.chart.update()),$(t.projects).each(function(){var r=dateFormat(t.startDate,"yyyy-mm-dd")+"T00:00:00.000";a.getProjectIncidentsCountById(this.ProjectId).then($.proxy(function(c){var n=c.data;a.getProjectIncidentsByCreationDate(this.ProjectId,n,r).then(function(a){Array.prototype.push.apply(t.incidents,a.data),t.projects.length-1==e&&(t.loading=!1,t.init()),e++})},this))})},t.init=function(){t.chartTitle=dateFormat(t.startDate,"yyyy-mm-dd")+" → "+dateFormat(t.endDate,"yyyy-mm-dd"),t.incidents=i.getIncidentsByDateRanges(t.incidents,t.startDate,t.endDate),t.filterReleaseByMonths(),t.filterByReleases(),t.filterByProjectName()},t.filterReleaseByMonths=function(){t.chart1={},t.chart1.labels=i.getLabelsArray(t.incidents,"CreationDate","month"),t.chart1.data=i.bindArrayWithQuantity(t.chart1.labels,t.incidents,"filterByMonth"),t.chart1.display=i.validateDataArray(t.chart1.data),t.chart1.options={defaultFontStyle:"italic",title:{display:!0,text:""},legend:{display:!0}},t.chart1.chart=i.setChartObject("chart1","bar",t.chart1.labels,t.chart1.data,t.chart1.options,"Incidents",n.CHART_COLORS[0],n.CHART_COLORS[1],"")},t.filterByProjectName=function(){t.chart2={},t.chart2.labels=i.getLabelsArray(t.incidents,"ProjectName","default"),t.chart2.data=i.bindArrayWithQuantity(t.chart2.labels,t.incidents,"filterByReleaseProjectName"),t.chart2.display=i.validateDataArray(t.chart2.data),t.chart2.options={defaultFontSize:4,scales:{xAxes:[{ticks:{fontSize:8}}]},defaultFontStyle:"italic",title:{display:!0,text:""},legend:{display:!1}},t.chart2.chart=i.setChartObject("chart2","bar",t.chart2.labels,t.chart2.data,t.chart2.options,"Incidents",n.CHART_COLORS[0],n.CHART_COLORS[1],"")},t.filterByReleases=function(){t.chart3={},t.chart3.labels=i.getLabelsArray(t.incidents,"DetectedReleaseVersionNumber","default"),t.chart3.data=i.bindArrayWithQuantity(t.chart3.labels,t.incidents,"filterByReleaseVersionNumber"),t.chart3.display=i.validateDataArray(t.chart3.data),t.chart3.options={defaultFontSize:4,scales:{xAxes:[{ticks:{fontSize:7}}]},defaultFontStyle:"italic",title:{display:!0,text:""},legend:{display:!1}},t.chart3.chart=i.setChartObject("chart3","bar",t.chart3.labels,t.chart3.data,t.chart3.options,"Incidents",n.CHART_COLORS[0],n.CHART_COLORS[1],"")},t.getDates=function(){switch(t.filterBy){case"month":t.getWeekDates();break;case"year":t.getMonthDates();break;case"decade":t.getYearDates()}},t.getWeekDates=function(){for(var e=moment(t.selected.date);e.day();)e.subtract(1,"days");t.startDate=e.format("YYYY-MM-DD"),t.endDate=e.add(6,"days").format("YYYY-MM-DD")},t.getMonthDates=function(){for(var e=moment(t.selected.date);e.day();)e.subtract(1,"days");t.startDate=e.format("YYYY-MM-DD"),t.endDate=e.add(1,"months").format("YYYY-MM-DD")},t.getYearDates=function(){for(var e=moment(t.selected.date);e.day();)e.subtract(1,"days");t.startDate=e.format("YYYY-MM-DD"),t.endDate=e.add(1,"years").format("YYYY-MM-DD")}},app.controller("ProjectViewerCtrl",["$scope","$stateParams","dataService","$filter","$timeout","constantsService","helperService",app.controllers.projectsViewer])}();
!function(){app.filter("trust",["$sce",function(t){return function(n){return t.trustAsHtml(n)}}])}();
!function(){app.filter("filterFindBy",["constantsService",function(e){return function(a,t){for(var r=[],s=t[0],n=t[1],i=0;i<a.length;i++){var m=a[i];switch(n){case"filterByReleaseId":m.DetectedReleaseId==s&&r.push(m);break;case"filterByMonth":Date.prototype.monthNames=e.APP_PROJECT_MONTHS,Date.prototype.getMonthName=function(){return this.monthNames[this.getMonth()]};var o=new Date(moment(m.CreationDate)).getMonthName();o==s&&r.push(m);break;case"filterByYear":var c=moment(new Date(moment(m.CreationDate))).year();c==s&&r.push(m);break;case"filterByReleaseValue":m.ReleaseId==s&&r.push(m.Name);break;case"filterActiveRelease":m.Active==s&&r.push(m);break;case"filterReleaseExist":s.map(function(e){m==e.ReleaseId&&r.push(m)});break;case"filterByReleaseVersionNumber":m.DetectedReleaseVersionNumber==s&&r.push(m);break;case"filterByReleaseProjectName":m.ProjectName==s&&r.push(m);break;case"filterReleaseVersionNumber":s.map(function(e){m.VersionNumber==e&&r.push(m)});break;case"filterReleaseByReleaseId":m.ReleaseId==s&&(r=m);break;case"filterByIncidentTypeName":m.IncidentTypeName==s&&r.push(m);break;case"filterByIncidentStatusName":m.IncidentStatusName==s&&r.push(m);break;case"filterByIncidentOpenerName":m.OpenerName==s&&r.push(m);break;case"filterByPriorityName":m.PriorityName==s&&r.push(m);break;case"filterByDateRanges":var l=moment(dateFormat(moment(new Date(moment(m.CreationDate))),"yyyy-mm-dd")),u=s.split("|"),p=(moment(u[0]),moment(u[1]));l.isSameOrBefore(p)&&r.push(m)}}return r}}])}();
!function(){var e={PROJECTS:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects?",PROJECT:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects/{0}?",PROJECT_RELEASES:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects/{0}/releases?",PROJECT_USERS:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects/{0}/users?",PROJECT_INCIDENTS:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects/{0}/incidents/search?start_row=0&number_rows={1}&",PROJECT_INCIDENTS_TYPES:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects/{0}/incidents/types?",PROJECT_INCIDENTS_DATE:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects/{0}/incidents/recent?start_row=0&number_rows={1}&creation_date={2}&",PROJECT_INCIDENTS_COUNT:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects/{0}/incidents/count?",PROJECT_CUSTOM_TYPES:"https://spira.dxide.com/Services/v4_0/RestService.svc/projects/{0}/custom-properties?"};app.constant("apiService",e)}();
!function(){function e(e){var t=$.proxy(function(t,n){e.set("username",t),e.set("token",n)},this),n=function(){return void 0!=r()},r=$.proxy(function(){return e.get("username")},this),o=$.proxy(function(){return e.get("token")},this),i=function(){e.remove("projects"),e.remove("username"),e.remove("token")};return{isLoggedAlready:n,getUsername:r,getToken:o,createCredentials:t,deleteCredentials:i}}e.$inject=["localStorageService"],app.factory("authService",e)}();
!function(){var e={APP_TITLE:"Spira Toolbox",APP_DESCRIPTION:"Great for learning Angular features.",APP_VERSION:"1.0",APP_NAVIGATION:[{state:"app",header:"Me",active:!1},{state:"app.projects",header:"Projects",active:!1},{state:"app.reviewer",header:"Reviewer",active:!1}],APP_AUTH_SUCCESS_TITLE:"Awesome.",APP_AUTH_SUCCESS_MESSAGE:"You were successfully authenticated.",APP_AUTH_ERROR_TITLE:"Oh no!.",APP_AUTH_ERROR_MESSAGE:"Please provide valid user information.",APP_PROJECT_MONTHS:["January","February","March","April","May","June","July","August","September","October","November","December"],APP_PROJECT_YEARS:["2015","2016","2017","2018","2019","2020","2021","2022","2023","2024","2025","2025","2026"],CHART_TITLES:["Total Incidents Reported By Year","Total Incidents Reported By Release","Total Release Incidents Reported By Type","Total Release Incidents Reported By Status","Total Release Incidents Reported By Opener","Total Release Incidents Reported By Priority"],CHART_COLORS:["rgb(146,146,146)","rgb(7,54,66)","rgb(244,243,86)","rgb(248,248,248)","rgb(252,248,227)","rgb(245,216,87)","rgb(242,158,86)","rgb(102,255,255)","rgb(255,255,204)","rgb(242,158,86)","rgb(245,216,87)","rgb(244,243,86)","rgb(244,116,87)","rgb(228,255,0)"]};app.constant("constantsService",e)}();
!function(){function e(e,r,t,n){var c=function(r,t){var n=f(e.PROJECTS,r,t);return C(n)},a=function(){return n.get("username")},u=function(){return n.get("token")},o=function(){return n.get("projects")},i=function(r){var t=f(e.PROJECT,a(),u());return C(t.replace("{0}",r))},l=function(r){var t=f(e.PROJECT_RELEASES,a(),u());return C(t.replace("{0}",r))},P=function(r){var t=f(e.PROJECT_USERS,a(),u());return C(t.replace("{0}",r))},E=function(r,t){var n=f(e.PROJECT_INCIDENTS,a(),u());return C(n.replace("{0}",r).replace("{1}",t))},p=function(r){var t=f(e.PROJECT_INCIDENTS_TYPES,a(),u());return C(t.replace("{0}",r))},s=function(r){var t=f(e.PROJECT_INCIDENTS_COUNT,a(),u());return C(t.replace("{0}",r))},I=function(r){var t=f(e.PROJECT_CUSTOM_TYPES,a(),u());return C(t.replace("{0}",r))},T=function(r,t,n){var c=f(e.PROJECT_INCIDENTS_DATE,a(),u());return C(c.replace("{0}",r).replace("{1}",t).replace("{2}",n))},C=function(e){return r({method:"JSONP",url:t.trustAsResourceUrl(e),callbackKey:"callback"})},f=function(e,r,t){return e+"username="+r+"&api-key="+t};return{authUser:c,getAllProjects:o,getProjectById:i,getProjectReleasesById:l,getProjectUsersById:P,getProjectIncidentsById:E,getProjectIncidentsTypeById:p,getProjectIncidentsCountById:s,getProjectCustomPropertiesById:I,getProjectIncidentsByCreationDate:T}}e.$inject=["apiService","$http","$sce","localStorageService"],app.factory("dataService",e)}();
!function(){function e(e,t){var r=function(t,r,a){var n=[];return $(t).each(function(t,o){var i=[o,a],c=e("filterFindBy")(r,i);n.push(c.length)}),n},a=function(t,r,a){var n=[];return $(t).each(function(t,o){var i=[o,a],c=e("filterFindBy")(r,i);n.push(c)}),n},n=function(e,r,a){var n=[];return $(e).each(function(e,o){switch(a){case"default":n.indexOf(o[r])==-1&&o[r]&&n.push(o[r]);break;case"year":var i=moment(o[r]).year();n.indexOf(i)==-1&&i&&n.push(i);break;case"month":var c=t.APP_PROJECT_MONTHS[moment(o[r]).month()];n.indexOf(c)==-1&&c&&n.push(c)}}),n},o=function(e){var t=!1;return 0==e.length?t:(e.map(function(e){0!=e&&(t=!0)}),t)},i=function(e,t,r,a,n,o,i,s,u,d){var l=document.getElementById(e),C={};switch(C.options={},t){case"bar":dataset={label:o,data:a,backgroundColor:c(i,r,u),borderColor:c(s,r,"border"),borderWidth:1},C.options=n,void 0!=d&&1!=d||(C.options.events=!1,C.options.tooltips={enabled:!0},C.options.animation={duration:1,onComplete:function(){var e=this.chart,t=e.ctx;t.font=Chart.helpers.fontString(10,"bold",Chart.defaults.global.defaultFontFamily),t.textAlign="center",t.textBaseline="bottom",this.data.datasets.forEach(function(r,a){var n=e.controller.getDatasetMeta(a);n.data.forEach(function(e,a){var n=r.data[a];t.fillStyle="black",t.fillText(n,e._model.x,e._model.y-2)})})}});break;case"pie":dataset={label:o,data:a,backgroundColor:c(i,r,u),borderColor:c(s,r,"border"),borderWidth:1},C.options=n}C.type=t,C.data={labels:r,datasets:[dataset]},l=new Chart(l,C)},c=function(e,r,a){return r.map(function(r){if("border"==a)return e;switch(r){case"Closed":return t.CHART_COLORS[2];case"New":return t.CHART_COLORS[3];case"Open":return t.CHART_COLORS[4];case"Retest DEV":return t.CHART_COLORS[5];case"Retest QA":return t.CHART_COLORS[12];case"Rejected":return t.CHART_COLORS[6];case"1 - High":return t.CHART_COLORS[12];case"2 - Major":return t.CHART_COLORS[9];case"3 - Medium":return t.CHART_COLORS[10];case"4 - Low":return t.CHART_COLORS[11];case"5 – Task/Enhancement":return t.CHART_COLORS[8];case"6 - Deferred":return t.CHART_COLORS[7];case"7":return t.CHART_COLORS[6];case"8":return t.CHART_COLORS[6];default:return e}})},s=function(t,r,a){var n=[dateFormat(r,"yyyy-mm-dd")+"|"+dateFormat(a,"yyyy-mm-dd"),"filterByDateRanges"];return e("filterFindBy")(t,n)};return{bindArrayWithQuantity:r,bindArrayWithValue:a,getLabelsArray:n,validateDataArray:o,setChartObject:i,getColorsArray:c,getIncidentsByDateRanges:s}}e.$inject=["$filter","constantsService"],app.factory("helperService",e)}();
!function(){function r(){var r=function(r,t){toastr.success(t,r)},t=function(r,t){toastr.info(t,r)},o=function(r,t){toastr.error(t,r)};return{success:r,info:t,error:o}}app.factory("toastrService",r)}();
!function(){app.component("bars",{templateUrl:"./views/projects/charts/chartBars.html",bindings:{data:"=",selector:"@",title:"@",display:"=",year:"="},controllerAs:"mv",controller:["$scope",app.controllers.chartBars]})}();
!function(){app.component("appheader",{templateUrl:"./views/commons/header.html",controllerAs:"mv",controller:["$scope","constantsService","localStorageService",app.controllers.header]})}();


